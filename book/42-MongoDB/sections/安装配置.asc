=== 安装配置

*基于 CentOS8*

官方安装文档::
https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/[Install MongoDB Community Edition on Red Hat or CentOS]

=== 安装
[source, bash]
----
cat > /etc/yum.repos.d/mongodb-org-4.2.repo << EOF
[mongodb-org-4.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc
EOF

dnf install -y mongodb-org
----

==== 文件目录结构

配置文件:: /etc/mongod.conf （YML格式）

.配置文件说明
.. `storage.dbPath`： 指定数据目录，默认 `/var/lib/mongo`
.. `systemLog.path`： 指定日志目录，默认 `/var/log/mongodb`
.. `net.port`： 指定监听端口，默认 `27017`
.. `net.bindIp`： 指定监听IP，默认 `127.0.0.1`

[NOTE]
默认情况下，只有 `mongod` 用户有数据目录和日志目录的读写权限。

=== 配置

==== 禁用SELINUX（重启生效）

[source, bash]
----
echo SELINUX=disabled>/etc/selinux/config
echo SELINUXTYPE=targeted>>/etc/selinux/config
----

==== 设置 `ulimit`
[source, bash]
----
echo "*               soft   nofile            65535" >> /etc/security/limits.conf
echo "*               hard   nofile            65535" >> /etc/security/limits.conf
----

[start=2]
. 文件路径

==== 开机启动

. 开机启动 `systemctl enable mongod`
. 禁用启动 `systemctl disable mongod`

==== 服务管理

. 启动服务 `systemctl start mongod`
. 查看状态 `systemctl status mongod`

. 重启服务 `systemctl start mongod`
. 停止服务 `systemctl start mongod`

==== 验证服务

. 查看端口 `ss -antpl|grep 27017`
. 查看启动日志 `grep 'waiting for connections' /var/log/mongodb/mongod.log`

[source, bash]
----
# grep 'waiting for connections' /var/log/mongodb/mongod.log
2019-10-24T20:41:22.920+0800 I  NETWORK  [initandlisten] waiting for connections on port 27017
----

==== 开始使用 `MongoDB`

[source, bash]
----
# mongo
MongoDB shell version v4.2.1
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("62502a6d-2c7f-4f29-9a16-df0454f87baa") }
MongoDB server version: 4.2.1
Server has startup warnings:
2019-10-24T20:41:22.868+0800 I  CONTROL  [initandlisten]
2019-10-24T20:41:22.868+0800 I  CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.
2019-10-24T20:41:22.868+0800 I  CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.
2019-10-24T20:41:22.868+0800 I  CONTROL  [initandlisten]
2019-10-24T20:41:22.868+0800 I  CONTROL  [initandlisten]
2019-10-24T20:41:22.868+0800 I  CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/enabled is 'always'.
2019-10-24T20:41:22.868+0800 I  CONTROL  [initandlisten] **        We suggest setting it to 'never'
2019-10-24T20:41:22.868+0800 I  CONTROL  [initandlisten]
---
Enable MongoDB's free cloud-based monitoring service, which will then receive and display
metrics about your deployment (disk utilization, CPU, operation statistics, etc).

The monitoring data will be available on a MongoDB website with a unique URL accessible to you
and anyone you share the URL with. MongoDB may use this information to make product
improvements and to suggest MongoDB products and deployment options to you.

To enable free monitoring, run the following command: db.enableFreeMonitoring()
To permanently disable this reminder, run the following command: db.disableFreeMonitoring()
---

>
----