= XXL-JOB

== 配置环境

=== maven

安装 `maven` 3.0
`yum install -y maven`

.查看 `maven` 版本
[source,console]
----
[root@localhost work]# mvn -v
Apache Maven 3.0.5 (Red Hat 3.0.5-17)
----

=== java

.安装 `java` 11
`yum install -y java-11-openjdk java-11-openjdk-devel java-11-openjdk-headless`

.修改 `java` 版本
`alternatives --set java `ls /usr/lib/jvm/java-11-openjdk-*/bin/java`` +
`alternatives --set jre_openjdk /usr/lib/jvm/java-11-openjdk-11.0.5.10-0.el7_7.x86_64` +
`alternatives --set java_sdk_openjdk /usr/lib/jvm/java-11-openjdk-11.0.5.10-0.el7_7.x86_64`

.查看 `java` 版本
[source,console]
----
[root@localhost ~]# java -version
openjdk version "11.0.5" 2019-10-15 LTS
----

=== mariadb

.安装 `mariadb`
`yum install -y mariadb-server mariadb`

.设置密码
`mysqladmin -uroot password "geek"`

[TIP]
mysql 安装后没有密码，可以 `mysql` 登陆

.查看 `mysql` 版本
[source,console]
----
[root@localhost resources]# mysql --version
mysql  Ver 15.1 Distrib 5.5.64-MariaDB, for Linux (x86_64) using readline 5.1
----

== 安装xxl-job

=== maven 构建

.下载源码
`mkdir  ~/download/ && cd ~/download/`
`git clone https://github.com/xuxueli/xxl-job.git` +
`cd xxl-job`


.编译打包
`mvn package`

.备份
`mkdir -p /data/xxl_job` +
`cp xxl-job-admin/src/main/resources/application.properties /data/xxl_job/` +
`cp xxl-job-admin/target/xxl-job-admin-2.2.0-SNAPSHOT.jar /data/xxl_job/`



=== 数据库配置
.初始化数据库
`mysql -uroot -pgeek -e "CREATE DATABASE xxl_job DEFAULT CHARACTER SET utf8mb4 DEFAULT COLLATE utf8mb4_unicode_ci;"` +
`mysql -uroot -pgeek xxl_job < /root/download/xxl-job/doc/db/tables_xxl_job.sql`

.查看导入表
[source,console]
----
[root@localhost db]# mysql -uroot -pgeek xxl_job -e "show tables;"
+--------------------+
| Tables_in_xxl_job |
+--------------------+
| xxl_job_group      |
| xxl_job_info          |
| xxl_job_lock          |
...
----

.更改数据库配置
`sed -i '26s/spring.datasource.username=root/spring.datasource.username=root/' xxl-job-admin/src/main/resources/application.properties` +
`sed -i '27s/spring.datasource.password=root_pwd/spring.datasource.password=geek/' xxl-job-admin/src/main/resources/application.properties`

.启动jar包
`java -jar /data/xxl_job/xxl-job-admin-2.2.0-SNAPSHOT.jar`

.调度中心访问地址，默认登录账号：admin/123456
http://localhost:8080/xxl-job-admin

== 执行器

.执行器配置
[source, bash]
----
sed -i '9s#xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin#xxl.job.admin.addresses=http://192.168.2.22:8080/xxl-job-admin#' xxl-job-executor-samples/xxl-job-executor-sample-springboot/src/main/resources/application.properties

sed -i '12s/xxl.job.executor.appname=xxl-job-executor-sample/xxl.job.executor.appname=xxl14/' xxl-job-executor-samples/xxl-job-executor-sample-springboot/src/main/resources/application.properties
----

.编译打包
`mvn package`

.部署
[source,bash]
----
scp  /data/xxl_job/application.properties root@192.168.2.19:/data/xxl_job/

scp  /data/xxl_job/xxl-job-executor-sample-springboot-2.2.0-SNAPSHOT.jar root@192.168.2.19:/data/xxl_job/
----

.到服务器 `192.168.2.19` 启动执行器
`java -jar /data/xxl_job/xxl-job-executor-sample-springboot-2.2.0-SNAPSHOT.jar`

